{% extends "base.html" %}

{% block title %}Références - eXalt{% endblock %}

{% block content %}
<div class="text-center">
  <h1>Références</h1>
  <p class="mb-6">Liste de toutes les références avec statut de contact</p>
  <form method="get" style="max-width: 600px; margin: 1rem auto; display: flex; gap: 0.5rem;">
    <input type="text" name="q" value="{{ q }}" placeholder="Recherche: candidat, référent, entreprise, email, téléphone" style="flex:1;" />
    <button type="submit">Rechercher</button>
  </form>
  {% if q %}
    <p style="color:#6b7280;">Filtre: "{{ q }}"</p>
  {% endif %}
  <div style="margin: 0.5rem 0; color:#6b7280; font-size:0.9rem;">
    Légende: <span style="color:#059669;">●</span> contacté • <span style="color:#dc2626;">●</span> non contacté
  </div>
  
</div>

<div style="background: rgba(255, 255, 255, 0.9); border-radius: 8px; padding: 1.5rem;">
  <table>
    <thead>
      <tr>
        <th>Statut</th>
        <th>Candidat</th>
        <th>Référent</th>
        <th>Entreprise</th>
        <th>Email</th>
        <th>Téléphone</th>
        <th>Créée le</th>
        <th>Interactions</th>
      </tr>
    </thead>
    <tbody>
      {% for ref in references %}
      {% with contacted=ref.interactions.count %}
      <tr style="cursor: pointer;" onclick="window.location.href='{% url 'reference_detail' ref.id %}'" onmouseover="this.style.backgroundColor='#f3f4f6'" onmouseout="this.style.backgroundColor=''">
        <td style="text-align:center;">
          {% if contacted %}
            <span title="Contacté" style="color:#059669; font-size: 1.1rem;">●</span>
          {% else %}
            <span title="Non contacté" style="color:#dc2626; font-size: 1.1rem;">●</span>
          {% endif %}
        </td>
        <td>{{ ref.candidate.name }}</td>
        <td>{{ ref.referent.name }}</td>
        <td>{{ ref.corporation.name }}</td>
        <td>{{ ref.referent.email }}</td>
        <td>{{ ref.referent.phone }}</td>
        <td>{{ ref.created_at|date:"d/m/Y H:i" }}</td>
        <td>{{ ref.interactions.count }}</td>
      </tr>
      {% endwith %}
      {% empty %}
      <tr>
        <td colspan="8" style="text-align:center; color:#6b7280;">Aucune référence trouvée.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

